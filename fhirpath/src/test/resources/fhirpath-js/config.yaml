# This file documents exclusions from the test cases along with justification of why the tests are
# excluded and links to related issues.
excludeSet:
  - title: Global exclusions
    glob: "*.yaml"
    exclude:
      - title: Unsupported resources
        type: feature
        id: "#2418"
        expression:
          - "^StructureDefinition"
      - title: Parse error
        type: wontfix
        comment: |
          The test case is not valid FHIRPath syntax, it contains a parse error.
        any:
          - "@T17:00-05:00 < timeWithT.toTime()"
          - "@T17:00-05:00 > timeWithT.toTime()"
          - "@T17:00-05:00 < timeWithOutT.toTime()"
          - "@T17:00-05:00 > timeWithOutT.toTime()"
          - "('a'|'b'|'c').join(',')"
          - "('a'|'b'|'c').join()"
          - "time.toTime() = @T19:15-05:00"
          - "time.toTime() = @T18:15-05:00"
          - "time.toTime() != @T18:15-05:00"
          - "('a'|'b'|'c').aggregate($total & '-' & $this, 'concat')"
          - "(1 'cm'|3 'cm'|1 'm').aggregate($total + $this, 0 'cm') = 104 'cm'"
          - "(1 'cm'|3 'cm'|1 'kg'|1 'm').aggregate($total + $this, 0 'cm')"
          - "(1|2|3|4|5|6|7|8|9).sum() = 45"
          - "(1 'cm'|3 'cm'|1 'm').sum() = 104 'cm'"
          - "(7|8|9|1|2|3|4|5|6).min() = 1"
          - "(1 'cm'|3 'cm'|1 'm').min() = 1 'cm'"
          - "(7|8|9|1|2|3|4|5|6).max() = 9"
          - "(1 'cm'|3 'cm'|1 'm').max() = 1 'm'"
          - "(7|8|9|1|2|3|4|5|6).avg() = 5"
          - "(7 'm' |8 'm'|9 'm'|1 'm'|2 'm'|3 'm'|400 'cm'|5 'm'|6 'm').avg() = 5 'm'"
          - "@T10:04:23-04:00 ~ @T18:04:23+04:00"
          - "@T10:04:23-04:00 ~ @T18:04:24+04:00"
          - "@T10:04:23-04:00 ~ @T14:04:23Z"
          - "@T10:04:23-04:00 ~ @T14:04:24Z"
          - "@T10:04:23-04:00 !~ @T18:04:23+04:00"
          - "@T10:04:23-04:00 !~ @T18:04:24+04:00"
          - "@T10:04:23-04:00 !~ @T14:04:23Z"
          - "@T10:04:23-04:00 !~ @T14:04:24Z"
          - "(1|2|3|4|5|6|7|8|9).aggregate($this+$total, 0) = 45"
          - "(1|2|3|4|5|6|7|8|9).aggregate($this+$total, 2) = 47"
          - "(1|2|3|4|5|6|7|8|9).aggregate(iif($total.empty(), $this, iif($this < $total, $this, $total))) = 1"
          - "(1|2|3|4|5|6|7|8|9).aggregate(iif($total.empty(), $this, iif($this > $total, $this, $total)"
          - "@T12+04:00 > @T12:02:34.324+05:00"
          - "@T12:02:34.324+05:00 > @T12+05:00"
          - "@T23:59:23-05:00 + 2 minutes = @T00:01:23-05:00"
          - "@T23:59:23-05:00 + 5 milliseconds = @T23:59:23.005-05:00"
          - "@T23:59:23-05:00 + 1.5 seconds = @T23:59:24.500-05:00"
          - "@T23:59:23-05:00 + 1.5 's' = @T23:59:24.500-05:00"
          - "@T23:59:23-05:00 - 1.5 's' = @T23:59:21.500-05:00"
          - "@T23:59:23-05:00 + 1000 milliseconds = @T23:59:24-05:00"
          - "@T23:59:23.005-05:00 + 995 milliseconds = @T23:59:24-05:00"
          - "@T23:59:23.005-05:00 + 1990 milliseconds = @T23:59:24.995-05:00"
          - "@T23:59:23-05:00 + 1.5 hours = @T00:59:23-05:00"
          - "@T10:04:23-04:00 = @T18:04:23+04:00"
          - "@T19:01:23-05:00 = @T00:01:23-00:00"
          - "@T10:04:23-04:00 = @T18:04:24+04:00"
          - "@T10:04:23-04:00 = @T14:04:23Z"
          - "@T10:04:23-04:00 = @T14:04:24Z"
          - "@T10:04:23-04:00 = @T14:04Z"
          - "@T10:05:23-04:00 = @T14:04Z"
          - "@T10:04:23-04:00 != @T18:04:23+04:00"
          - "@T10:04:23-04:00 != @T18:04:24+04:00"
          - "@T10:04:23-04:00 != @T14:04:23Z"
          - "@T10:04:23-04:00 != @T14:04:24Z"
  - title: Path exclusions
    glob: "fhirpath-js/cases/3.2_paths.yaml"
    exclude:
      - title: "Mixed collections not supported"
        type: wontfix
        outcome: failure
        comment: |
          Pathling does not support the representation of mixed collections, which is required for
          these tests.
        any:
          - "Observation.value with an R4 FHIR model"
          - "Observation.value with an R5 FHIR model"
          - "Observation.value with an STU3 FHIR model"
          - "Observation.value with an DSTU2 FHIR model"
      - title: "Mixed collections not supported"
        type: wontfix
        outcome: pass
        comment: |
          Pathling does not support the representation of mixed collections, which is required for
          these tests.
        any:
          - "Observation.value without a model"
      - title: "Contained resources not supported"
        type: feature
        id: "#2406"
        expression:
          - "(^|\\W)contained(\\W|$)"
      - title: "Custom fields not supported within FHIR resources"
        type: wontfix
        outcome: failure
        comment: Pathling does not support custom fields within FHIR resources.
        any:
          - "Access a custom field starting with a capital letter (1)"
          - "Access a custom field starting with a capital letter (2)"
  - title: Subsetting exclusions
    glob: "fhirpath-js/cases/5.3_subsetting.yaml"
    exclude:
      - title: "Primitive attributes"
        id: "#437"
        type: feature
        outcome: failure
        comment: |
          This test requires support for the primitive attribute/extension structure, as it involves 
          traversing to the `id` of a primitive element.
        any:
          - "** first for collection with null values"
  - title: Literal exclusions
    glob: "fhirpath-js/cases/4.1_literals.yaml"
    exclude:
      - title: "Using ` to wrap a string is not allowed by grammar"
        type: bug
        outcome: failure
        comment: |
          An issue has been raised on the fhirpath.js GitHub repository (#172), this may be an 
          incorrect expectation within the test cases.
        any:
          - "`a\\\\b\\'\\\"\\`\\r\\n\\t\\u0065`"
  - title: String manipulation exclusions
    glob: "fhirpath-js/cases/5.6_string_manipulation.yaml"
    exclude:
      - title: "Input of empty collection to join function causes error"
        type: bug
        id: "#2443"
        any:
          - "** join on empty input collection"
      - title: "Parse error"
        type: wontfix
        outcome: pass
        comment: |
          The test case is not valid FHIRPath syntax, it contains a parse error.
        any:
          - "('a'|'2023-05-28'.toDate()|'c').join(',')"
          - "('a'|'2023-05-28'.toDate()|'c').join(',')"
  - title: Existence exclusions
    glob: "fhirpath-js/cases/5.1_existence.yaml"
    exclude:
      - title: "Incorrect behaviour when evaluating boolean value of collections"
        type: bug
        outcome: failure
        id: "#2411"
        any:
          - "** error for collection that is not a singleton"
      - title: Support for null values within FHIR elements
        type: wontfix
        outcome: failure
        any:
          - "** null is not empty"
          - "** exists for null should return true"
  - title: Filtering and projection exclusions
    glob: "fhirpath-js/cases/5.2_filtering_and_projection.yaml"
    exclude:
      - title: "Test runner does not support representation of mixed collections in arbitrary objects"
        type: wontfix
        outcome: failure
        any:
          - "heteroattr.ofType(String)"
          - "heteroattr.ofType(Integer)"
          - "heteroattr.ofType(Decimal)"
          - "heteroattr.ofType(Boolean)"
  - title: Equality exclusions
    glob: "fhirpath-js/cases/6.1_equality.yaml"
    exclude:
      - title: "Bundles are not supported"
        type: feature
        id: "#2418"
        expression:
          - "(^|\\W)Bundle(\\W|$)"
      - title: "Support for null values within FHIR elements"
        type: wontfix
        outcome: failure
        any:
          - "** equality for null values"
          - "** inequality for null values"
      - title: Unsupported equality for complex types
        type: new-feature
        id: "#2420"
        any:
          - "** two objects"
          - "** two objects not"
  - title: Comparison exclusions
    glob: "fhirpath-js/cases/6.2_comparision.yaml"
    exclude:
      - title: Unsupported comparison of dates, times and date times
        type: new-feature
        id: "#2421"
        any:
          - "DiagnosticReport.issued < DiagnosticReport.effectiveDateTime"
          - "1 year > 12 months"
          - "1 year < 12 months"
          - "1 minute > 59 seconds"
          - "1 minute < 61 seconds"
  - title: Collections exclusions
    glob: "fhirpath-js/cases/6.4_collections.yaml"
    exclude:
      - title: Unsupported equality for complex types
        type: new-feature
        id: "#2420"
        any:
          - "el in emptycoll"
          - "el in coll"
          - "not_el in coll"
          - "coll contains el"
          - "coll contains not_el"
          - "ups in coll"
          - "coll contains empty"
        expression:
          - "^coll contains ups"
      - title: Unsupported equality for complex types
        type: new-feature
        id: "#2420"
        outcome: pass
        any:
          - "emptycoll contains ups"
  - title: Variable exclusions
    glob: "fhirpath-js/cases/8_variables.yaml"
    exclude:
      - title: "Unsupported context definition within view runner"
        type: new-feature
        outcome: failure
        id: "#2424"
        spel:
          - "#testCase.context == 'g1'"
  - title: Extension exclusions
    glob: "fhirpath-js/cases/extensions.yaml"
    exclude:
      - title: "ID on primitive types not supported"
        comment: "This also includes the case of an empty primitive value with non-empty attributes"
        type: feature
        outcome: failure
        id: "#437"
        any:
          - "** id for primitive type"
          - "Patient.address[1].id = 'someId'"
          - "** count nodes without value, but with extensions"
      - title: "extensions on primitive types not supported"
        type: feature
        outcome: pass
        id: "#437"
        any:
          - "** expression with extension for primitive type 1"
      - title: "extensions on primitive types not supported"
        type: feature
        outcome: failure
        id: "#437"
        any:
          - "** expression with extension for primitive type 3"
          - "Patient.communication.preferred.extension('test').value.id"
          - "Patient.communication.preferred.extension('test').exists()"
          - "Patient.name.given[0].extension('http://hl7.org/fhir/StructureDefinition/display').value = 'Jacomus1'"
          - "Patient.name.given[3].extension('http://hl7.org/fhir/StructureDefinition/display').value = 'Jacomus2'"
          - "** value of extension of extension (using FHIR model data)"
          - "** id of extension of extension"
  - title: Factory exclusions
    glob: "fhirpath-js/cases/factory.yaml"
    exclude:
      - title: "Custom factory not supported"
        type: feature
        id: "#2425"
        expression:
          - "%factory(\\W|$)"
  - title: Quantity Exclusions
    glob: "fhirpath-js/cases/fhir-quantity.yaml"
    exclude:
      - title: "Implicit conversion of polymorphic types not supported"
        id: "#2163"
        comment: "Should the value be implicitly converted to a quantity?"
        type: feature
        any:
          - "After converting 'a' to year it is equal to year"
          - "After converting 'a' to year it isn't equal to 'a'"
          - "After converting 'min' to minutes it is equal to minutes"
          - "Can access the comparator field when there isn't a need to convert"
  - title: Simple Exclusions
    glob: "fhirpath-js/cases/simple.yaml"
    exclude:
      - title: "Tick quotes identifiers not supported"
        id: "#2153"
        type: bug
        outcome: failure
        any:
          - "name.`family`"
      - title: "Boolean evaluation of collections"
        type: feature
        id: "#2166"
        any:
          - "Patient.name.exists(given)"
      - title: "Unsupported type runner feature: expression maps"
        type: new-feature
        any:
          - "Evaluating expression for a part of a resource"
      - title: "Unsupported comparison between typed complex value and expected structure"
        type: wontfix
        outcome: failure
        any:
          - "Patient.telecom.where($this.use = 'work')"
  - title: FHIR R4 Exclusions
    glob: "fhirpath-js/cases/fhir-r4.yaml"
    exclude:
      - title: "Tick quotes identifiers not supported"
        outcome: failure
        id: "#2153"
        type: bug
        any:
          - "** testEscapedIdentifier"
          - "** testSimpleBackTick1"
      - title: "Tick quotes identifiers not supported"
        id: "#2153"
        type: bug
        any:
          - "Patient.ofType(FHIR.`Patient`).type().name"
      - title: "Implicit conversion of polymorphic types not supported"
        type: feature
        id: "#2163"
        any:
          - "** testPolymorphismA"
          - "** testLiteralDecimalGreaterThanNonZeroTrue"
          - "** testLiteralDecimalGreaterThanZeroTrue"
          - "** testLiteralDecimalGreaterThanIntegerTrue"
          - "** testLiteralDecimalLessThanInteger"
          - "** testEquality28"
          - "** testNEquality24"
          - "** testLessThan22"
          - "** testLessOrEqual22"
          - "Observation.value >= 100 '[lb_av]'"
          - "Observation.value > 100 '[lb_av]'"
      - title: "incorrect multiplication/division of quantity literals"
        id: "#2168"
        comment: "E.g: 2.0 'cm' * 2.0 'm' = 0.040 'm2'"
        type: bug
        any:
          - "** testQuantity9"
          - "** testQuantity10"
      - title: "iff() with different true/false types not supported"
        comment: "E.g.: iif(true, true, 1/0)"
        type: ???
        any:
          - "** testCollectionBoolean5"
          - "** testCollectionBoolean6"
      - title: "Decimal literal exceeded maximum scale supported"
        id: "#2144"
        type: feature
        any:
          - "** testNEquality22"
          - "1.2 / 1.8 = 0.66666667"
          - "1.00000001.truncate() = 1"
          - "0.00000001.convertsToDecimal()"
      - title: "Extensions on primitive types not supported"
        type: feature
        outcome: failure
        id: "#437"
        any:
          - "Patient.birthDate.extension('http://hl7.org/fhir/StructureDefinition/patient-birthTime').exists()"
      - title: "Extensions on primitive types not supported"
        type: feature
        outcome: pass
        id: "#437"
        any:
          - "Patient.birthDate.extension('http://hl7.org/fhir/StructureDefinition/patient-birthTime1').empty()"
      - title: "Boolean evaluation of collections"
        type: feature
        outcome: failure
        id: "#2166"
        any:
          - "(1|2).not() = false"
