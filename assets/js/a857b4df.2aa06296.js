"use strict";(globalThis.webpackChunkpathling_site=globalThis.webpackChunkpathling_site||[]).push([[132],{2979:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"server/deployment/kubernetes","title":"Kubernetes","description":"Instructions for deploying Pathling server on Kubernetes using Helm.","source":"@site/docs/server/deployment/kubernetes.md","sourceDirName":"server/deployment","slug":"/server/deployment/kubernetes","permalink":"/docs/server/deployment/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/aehrc/pathling/tree/main/site/docs/server/deployment/kubernetes.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Kubernetes","description":"Instructions for deploying Pathling server on Kubernetes using Helm."},"sidebar":"server","previous":{"title":"Configuration","permalink":"/docs/server/configuration"},"next":{"title":"Synchronization","permalink":"/docs/server/deployment/synchronization"}}');var r=s(4848),i=s(8453);const o={sidebar_position:1,sidebar_label:"Kubernetes",description:"Instructions for deploying Pathling server on Kubernetes using Helm."},l="Kubernetes",c={},a=[{value:"Installation",id:"installation",level:2},{value:"Values",id:"values",level:2},{value:"Example configuration",id:"example-configuration",level:2},{value:"Single node",id:"single-node",level:3},{value:"Cluster",id:"cluster",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kubernetes",children:"Kubernetes"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/",children:"Kubernetes"})," is an open-source system for automating\ndeployment, scaling, and management of containerized applications. Support for\ndeploying Pathling on Kubernetes is provided via a ",(0,r.jsx)(n.a,{href:"https://helm.sh/",children:"Helm"}),"\nchart."]}),"\n",(0,r.jsx)(n.p,{children:"The Helm chart includes the following features:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Support\nfor ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/",children:"startup, liveness and readiness probes"}),"\npowered by\nthe ",(0,r.jsx)(n.a,{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html",children:"Spring Boot Actuator"}),"\nendpoint"]}),"\n",(0,r.jsx)(n.li,{children:"Services for the FHIR API, Actuator management API, Spark UI, driver endpoint\nand block manager endpoint"}),"\n",(0,r.jsxs)(n.li,{children:["Support for\nthe ",(0,r.jsx)(n.a,{href:"https://spark.apache.org/docs/latest/running-on-kubernetes.html",children:"Spark Kubernetes cluster manager"}),",\nincluding a service account, role and role binding to allow it to manage\nexecutor pods"]}),"\n",(0,r.jsxs)(n.li,{children:["Customisation of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/",children:"resource requests and limits"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/volumes/",children:"volumes and volume mounts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/",children:"Image pull secrets"}),"\nfor private Docker registries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/",children:"Tolerations and affinity"}),"\nfor control over pod scheduling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"Secret"})," config\nfor sensitive values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/",children:"Security context"}),"\nfor pod security settings"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.p,{children:"To install the chart, run the following commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Add the Pathling Helm repository.\nhelm repo add pathling https://pathling.csiro.au/helm\n\n# Get the latest information about charts from the repository.\nhelm repo update\n\n# Install the Pathling server chart as a release named `pathling`, with the\n# default values.\nhelm install pathling pathling/pathling\n"})}),"\n",(0,r.jsx)(n.h2,{id:"values",children:"Values"}),"\n",(0,r.jsx)(n.p,{children:"This is the list of the configuration values that the chart supports, along with\ntheir default values."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.image"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ghcr.io/aehrc/pathling:latest"})}),(0,r.jsx)(n.td,{children:"The Pathling Docker image to use"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.resources.requests.cpu"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})}),(0,r.jsx)(n.td,{children:"The CPU request for the Pathling pod"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.resources.requests.memory"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"4G"})}),(0,r.jsx)(n.td,{children:"The memory request for the Pathling pod"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.resources.limits.memory"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"4G"})}),(0,r.jsx)(n.td,{children:"The memory limit for the Pathling pod"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.resources.maxHeapSize"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2800m"})}),(0,r.jsx)(n.td,{children:"The maximum heap size for the JVM, should usually be about 75% of the available memory"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.additionalJavaOptions"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-Duser.timezone=UTC"})}),(0,r.jsx)(n.td,{children:"Additional Java options to pass to the JVM"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.deployment.strategy"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Recreate"})}),(0,r.jsxs)(n.td,{children:["The ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy",children:"deployment strategy"})," to use"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.deployment.imagePullPolicy"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Always"})}),(0,r.jsxs)(n.td,{children:["The ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/containers/images/#updating-images",children:"image pull policy"})," to use"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.volumes"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[ ]"})}),(0,r.jsxs)(n.td,{children:["A list of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/volumes/",children:"volumes"})," to mount in the pod"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.volumeMounts"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[ ]"})}),(0,r.jsxs)(n.td,{children:["A list of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/volumes/#using-volumes",children:"volume mounts"})," to mount"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.serviceAccount"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~"})}),(0,r.jsxs)(n.td,{children:["The ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/",children:"service account"})," to assign to the pod"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.imagePullSecrets"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[ ]"})}),(0,r.jsxs)(n.td,{children:["A list of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/",children:"image pull secrets"})," to use"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.tolerations"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[ ]"})}),(0,r.jsxs)(n.td,{children:["A list of ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/",children:"tolerations"})," to apply to the pod"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.affinity"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity",children:"Affinity"})," to apply to the pod"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.securityContext"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/",children:"Security context"})," for the pod"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.config"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{ }"})}),(0,r.jsxs)(n.td,{children:["A map of ",(0,r.jsx)(n.a,{href:"/docs/server/configuration",children:"configuration values"})," to pass to Pathling"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pathling.secretConfig"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{ }"})}),(0,r.jsxs)(n.td,{children:["A map of secret configuration values to pass to Pathling, these values will be stored using ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"Kubernetes secrets"})]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"example-configuration",children:"Example configuration"}),"\n",(0,r.jsx)(n.p,{children:"Here are a few examples of how to configure the Pathling Helm chart for\ndifferent deployment scenarios."}),"\n",(0,r.jsx)(n.h3,{id:"single-node",children:"Single node"}),"\n",(0,r.jsx)(n.p,{children:"This configuration is suitable for a single node deployment of Pathling. In this\nscenario, all processing is performed on a single pod."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'pathling:\n  image: ghcr.io/aehrc/pathling:8\n  resources:\n    requests:\n      cpu: 2\n      memory: 4G\n    limits:\n      memory: 4G\n    maxHeapSize: 3g\n  volumes:\n    - name: warehouse\n      hostPath:\n        path: /home/user/data/pathling\n  volumeMounts:\n    - name: warehouse\n      mountPath: /usr/share/warehouse\n      readOnly: false\n  config:\n    pathling.implementationDescription: My Pathling Server\n    pathling.terminology.cache.maxEntries: 500000\n    pathling.terminology.cache.overrideExpiry: "2592000"\n    pathling.encoding.openTypes: string,code,decimal,Coding,Address\n    logging.level.au.csiro.pathling: debug\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cluster",children:"Cluster"}),"\n",(0,r.jsxs)(n.p,{children:["This configuration is suitable for a cluster deployment of Pathling, using the\n",(0,r.jsx)(n.a,{href:"https://spark.apache.org/docs/latest/running-on-kubernetes.html",children:"Spark Kubernetes cluster manager"}),".\nIn this scenario, the driver pod hosts an API but processing is performed on\nexecutor pods, which are spawned by the driver pod through calls to the\nKubernetes API."]}),"\n",(0,r.jsx)(n.p,{children:"This configuration is suitable for the processing of larger datasets, or\nscenarios where it may be desirable to run a small driver pod and spawn executor\npods on demand (at the cost of some latency)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'pathling:\n  image: ghcr.io/aehrc/pathling:8\n  resources:\n    requests:\n      cpu: 1\n      memory: 2G\n    limits:\n      memory: 2G\n    maxHeapSize: 1500m\n  volumes:\n    - name: warehouse\n      hostPath:\n        path: /home/user/data/pathling\n  volumeMounts:\n    - name: warehouse\n      mountPath: /usr/share/warehouse\n      readOnly: false\n  serviceAccount: spark-service-account\n  config:\n    pathling.implementationDescription: My Pathling Server\n    pathling.terminology.cache.maxEntries: 500000\n    pathling.terminology.cache.overrideExpiry: "2592000"\n    pathling.encoding.openTypes: string,code,decimal,Coding,Address\n    logging.level.au.csiro.pathling: debug\n    spark.master: k8s://https://kubernetes.default.svc\n    spark.kubernetes.namespace: pathling\n    spark.kubernetes.executor.container.image: ghcr.io/aehrc/pathling:8\n    spark.kubernetes.executor.volumes.hostPath.warehouse.options.path: /home/user/data/pathling\n    spark.kubernetes.executor.volumes.hostPath.warehouse.mount.path: /usr/share/warehouse\n    spark.kubernetes.executor.volumes.hostPath.warehouse.mount.readOnly: false\n    spark.executor.instances: 3\n    spark.executor.memory: 3G\n    spark.kubernetes.executor.request.cores: 2\n    spark.kubernetes.executor.limit.cores: 2\n    spark.kubernetes.executor.request.memory: 4G\n    spark.kubernetes.executor.limit.memory: 4G\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);