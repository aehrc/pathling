"use strict";(globalThis.webpackChunkpathling_site=globalThis.webpackChunkpathling_site||[]).push([[8474],{4390:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"server/authorization","title":"Authorization","description":"Pathling can perform the role of a resource server within the OpenID Connect framework.","source":"@site/versioned_docs/version-7.2.0/server/authorization.md","sourceDirName":"server","slug":"/server/authorization","permalink":"/docs/7.2.0/server/authorization","draft":false,"unlisted":false,"editUrl":"https://github.com/aehrc/pathling/tree/main/site/versioned_docs/version-7.2.0/server/authorization.md","tags":[],"version":"7.2.0","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"description":"Pathling can perform the role of a resource server within the OpenID Connect framework."},"sidebar":"server","previous":{"title":"Configuration","permalink":"/docs/7.2.0/server/configuration"},"next":{"title":"Async","permalink":"/docs/7.2.0/server/async"}}');var r=n(4848),s=n(8453);const o={sidebar_position:6,description:"Pathling can perform the role of a resource server within the OpenID Connect framework."},a="Authorization",h={},c=[{value:"Authorities",id:"authorities",level:2},{value:"GA4GH passports",id:"ga4gh-passports",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"authorization",children:"Authorization"})}),"\n",(0,r.jsxs)(t.p,{children:["Pathling can perform the role of a resource server within the\n",(0,r.jsx)(t.a,{href:"https://openid.net/connect/",children:"OpenID Connect framework"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["When authorization is enabled through configuration, Pathling will refuse any\nrequests which are not accompanied by a valid\n",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6750",children:"bearer token"}),". The following requirements\nmust be met:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Token is a ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7519",children:"JSON Web Token"})]}),"\n",(0,r.jsxs)(t.li,{children:["Token contains an\n",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7519#section-4.1.3",children:"audience claim"})," that\nmatches the configured value"]}),"\n",(0,r.jsxs)(t.li,{children:["Token contains\nan ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7519#section-4.1.1",children:"issuer claim"}),"\nthat matches the configured value"]}),"\n",(0,r.jsxs)(t.li,{children:["Issuer provides\nan ",(0,r.jsx)(t.a,{href:"https://openid.net/specs/openid-connect-discovery-1_0.html",children:"OpenID Connect Discovery endpoint"}),"\nthat provides information about how to validate the token, including a link to\na\n",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7517",children:"JSON Web Key Set"})," containing the signing\nkey. This endpoint needs to be accessible to the Pathling server."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"authorities",children:"Authorities"}),"\n",(0,r.jsxs)(t.p,{children:["Pathling supports a set of authorities that control access to resources and\noperations. Authorities must be provided within the ",(0,r.jsx)(t.code,{children:"authorities"})," claim within\nthe JWT bearer token provided with each request."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.img,{alt:"Authorities",src:n(4410).A+"#light-mode-only",title:"Authorities",width:"914",height:"351"}),"\n",(0,r.jsx)(t.img,{alt:"Authorities",src:n(8971).A+"#dark-mode-only",title:"Authorities",width:"937",height:"351"})]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Authority"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling"})}),(0,r.jsx)(t.td,{children:"Provides access to all operations and resources, implies all other authorities."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:read"})}),(0,r.jsx)(t.td,{children:"Provides read access to all resource types."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:read:[resource type]"})}),(0,r.jsx)(t.td,{children:"Provides read access to only a specified resource type."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:write"})}),(0,r.jsx)(t.td,{children:"Provides write access to all resource types."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:write:[resource type]"})}),(0,r.jsx)(t.td,{children:"Provides write access to only a specified resource type."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:import"})}),(0,r.jsx)(t.td,{children:"Provides access to the import operation."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:aggregate"})}),(0,r.jsx)(t.td,{children:"Provides access to the aggregate operation."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:search"})}),(0,r.jsx)(t.td,{children:"Provides access to the search operation."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:extract"})}),(0,r.jsx)(t.td,{children:"Provides access to the extract operation."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:update"})}),(0,r.jsx)(t.td,{children:"Provides access to the update operation."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"pathling:batch"})}),(0,r.jsx)(t.td,{children:"Provides access to the batch operation."})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["In order to enable access to an operation, an operation authority (e.g.\n",(0,r.jsx)(t.code,{children:"pathling:search"}),") must be provided along with a ",(0,r.jsx)(t.code,{children:"read"})," or ",(0,r.jsx)(t.code,{children:"write"})," authority\n(e.g. ",(0,r.jsx)(t.code,{children:"pathling:read:Patient"}),")."]}),"\n",(0,r.jsx)(t.p,{children:"Where expressions within a request reference multiple different resource types\n(e.g. through resource references), authority for read access to all those\nresources must be present within the token."}),"\n",(0,r.jsxs)(t.p,{children:["The import and batch operations require ",(0,r.jsx)(t.code,{children:"write"})," authority for all resource types\nthat are referenced within the request."]}),"\n",(0,r.jsx)(t.h2,{id:"ga4gh-passports",children:"GA4GH passports"}),"\n",(0,r.jsxs)(t.p,{children:["Pathling supports an opt-in implementation of\n",(0,r.jsx)(t.a,{href:"https://github.com/ga4gh-duri/ga4gh-duri.github.io/blob/master/researcher_ids/ga4gh_passport_v1.md",children:"GA4GH Passport v1"}),",\nwhich is a way of encoding permission to access patient data within the access\ntoken presented to the server."]}),"\n",(0,r.jsxs)(t.p,{children:["You can enable GA4GH passport authentication by enabling the ",(0,r.jsx)(t.code,{children:"ga4gh"})," Spring\nprofile when running Pathling. Note that this profile is not enabled by default,\nand is not enabled within the pre-built Docker image."]}),"\n",(0,r.jsxs)(t.p,{children:["The Pathling implementation supports a visa type of ",(0,r.jsx)(t.code,{children:"ControlledAccessGrants"}),",\nwith a value that is interpreted as a dataset ID."]}),"\n",(0,r.jsxs)(t.p,{children:["The issuer and the dataset ID are used to construct a URL of the form\n",(0,r.jsx)(t.code,{children:"[issuer]/api/manifest/[dataset ID]"}),", which is used to retrieve a manifest\ndocument. The manifest contains additional information on how to enforce\npermissions for the visa."]}),"\n",(0,r.jsx)(t.p,{children:"The manifest document is expected to take the following form:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "patientIds": [\n    "patient-1",\n    "patient-2",\n    ...\n  ]\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["The patient IDs are combined with the\n",(0,r.jsx)(t.code,{children:"pathling.auth.ga4ghPassports.patientIdSystem"})," configuration parameter to create\nFHIR identifiers that Pathling can match against resources in the database."]}),"\n",(0,r.jsxs)(t.p,{children:["When running with GA4GH passports enabled, all queries will be scoped to return\nonly records that relate to white-listed patients, according to the joining\nlogic defined within\nthe ",(0,r.jsx)(t.a,{href:"https://hl7.org/fhir/R4/compartmentdefinition-patient.html",children:"FHIR Patient compartment"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["The presence of a ",(0,r.jsx)(t.code,{children:"ControlledAccessGrants"})," visa implies the following\nauthorities within Pathling: ",(0,r.jsx)(t.code,{children:"pathling:aggregate"}),", ",(0,r.jsx)(t.code,{children:"pathling:search"}),",\n",(0,r.jsx)(t.code,{children:"pathling:extract"})," (plus read access to all resources within the Patient\ncompartment)."]})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},4410:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/authorities-497dd9f3ccbd3a56ab8569df1e1250c9.svg"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(6540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}},8971:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/authorities-dark-c923573b0e997753385d61128b0bb85c.svg"}}]);