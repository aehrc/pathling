"use strict";(globalThis.webpackChunkpathling_site=globalThis.webpackChunkpathling_site||[]).push([[4346],{4418:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"server/operations/export","title":"Export","description":"The export operation allows FHIR data to be exported from the server in bulk using the FHIR Bulk Data Access specification.","source":"@site/docs/server/operations/export.md","sourceDirName":"server/operations","slug":"/server/operations/export","permalink":"/docs/server/operations/export","draft":false,"unlisted":false,"editUrl":"https://github.com/aehrc/pathling/tree/main/site/docs/server/operations/export.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"The export operation allows FHIR data to be exported from the server in bulk using the FHIR Bulk Data Access specification."},"sidebar":"server","previous":{"title":"Import (ping and pull)","permalink":"/docs/server/operations/import-pnp"},"next":{"title":"Bulk submit","permalink":"/docs/server/operations/bulk-submit"}}');var r=t(4848),i=t(8453);const o={sidebar_position:3,description:"The export operation allows FHIR data to be exported from the server in bulk using the FHIR Bulk Data Access specification."},l="Export",a={},d=[{value:"Export levels",id:"export-levels",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Output formats",id:"output-formats",level:2},{value:"NDJSON",id:"ndjson",level:3},{value:"Parquet",id:"parquet",level:3},{value:"Asynchronous processing",id:"asynchronous-processing",level:2},{value:"Kick-off request",id:"kick-off-request",level:3},{value:"Kick-off response",id:"kick-off-response",level:3},{value:"Polling",id:"polling",level:3},{value:"Response manifest",id:"response-manifest",level:2},{value:"Manifest fields",id:"manifest-fields",level:3},{value:"Retrieving results",id:"retrieving-results",level:2},{value:"Python example",id:"python-example",level:2},{value:"Export client",id:"export-client",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"export",children:"Export"})}),"\n",(0,r.jsxs)(n.p,{children:["The export operation allows FHIR data to be exported from Pathling in bulk. This\nimplementation follows the\n",(0,r.jsx)(n.a,{href:"https://build.fhir.org/ig/HL7/bulk-data/export.html",children:"FHIR Bulk Data Access specification"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"export-levels",children:"Export levels"}),"\n",(0,r.jsx)(n.p,{children:"Pathling supports export at multiple levels:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Level"}),(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"System"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET [base]/$export"})}),(0,r.jsx)(n.td,{children:"Export all resources in the server"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Patient type"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET [base]/Patient/$export"})}),(0,r.jsx)(n.td,{children:"Export all resources in the Patient compartment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Patient instance"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET [base]/Patient/[id]/$export"})}),(0,r.jsx)(n.td,{children:"Export resources for a specific patient"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Group"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET [base]/Group/[id]/$export"})}),(0,r.jsx)(n.td,{children:"Export resources for patients in a specific group"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Cardinality"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_outputFormat"})}),(0,r.jsx)(n.td,{children:"0..1"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["The format for exported files. Accepts ",(0,r.jsx)(n.code,{children:"application/fhir+ndjson"}),", ",(0,r.jsx)(n.code,{children:"application/ndjson"}),", ",(0,r.jsx)(n.code,{children:"ndjson"}),", ",(0,r.jsx)(n.code,{children:"application/vnd.apache.parquet"}),", or ",(0,r.jsx)(n.code,{children:"parquet"}),". Defaults to ",(0,r.jsx)(n.code,{children:"application/fhir+ndjson"}),". See ",(0,r.jsx)(n.a,{href:"#output-formats",children:"Output formats"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_since"})}),(0,r.jsx)(n.td,{children:"0..1"}),(0,r.jsx)(n.td,{children:"instant"}),(0,r.jsxs)(n.td,{children:["Only include resources where ",(0,r.jsx)(n.code,{children:"meta.lastUpdated"})," is after this time."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_until"})}),(0,r.jsx)(n.td,{children:"0..1"}),(0,r.jsx)(n.td,{children:"instant"}),(0,r.jsxs)(n.td,{children:["Only include resources where ",(0,r.jsx)(n.code,{children:"meta.lastUpdated"})," is before this time."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_type"})}),(0,r.jsx)(n.td,{children:"0..*"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Comma-delimited list of resource types to export. If omitted, all supported types are exported. Invalid types cause an error unless the ",(0,r.jsx)(n.code,{children:"Prefer: handling=lenient"})," header is included."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_elements"})}),(0,r.jsx)(n.td,{children:"0..*"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Comma-delimited list of elements to include. Specify as ",(0,r.jsx)(n.code,{children:"[type].[element]"})," (e.g., ",(0,r.jsx)(n.code,{children:"Patient.name"}),") or ",(0,r.jsx)(n.code,{children:"[element]"})," for all types. Only top-level elements are supported. Mandatory elements are always included."]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"output-formats",children:"Output formats"}),"\n",(0,r.jsx)(n.p,{children:"Pathling supports two output formats for bulk export:"}),"\n",(0,r.jsx)(n.h3,{id:"ndjson",children:"NDJSON"}),"\n",(0,r.jsxs)(n.p,{children:["The default format is ",(0,r.jsx)(n.a,{href:"http://ndjson.org/",children:"NDJSON"})," (Newline Delimited JSON),\nwhich outputs one FHIR resource per line as JSON. This format is specified by\nthe FHIR Bulk Data Access specification and is widely supported by FHIR tools."]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"application/fhir+ndjson"}),", ",(0,r.jsx)(n.code,{children:"application/ndjson"}),", or ",(0,r.jsx)(n.code,{children:"ndjson"})," as the\n",(0,r.jsx)(n.code,{children:"_outputFormat"})," value."]}),"\n",(0,r.jsx)(n.h3,{id:"parquet",children:"Parquet"}),"\n",(0,r.jsxs)(n.p,{children:["Pathling also supports export to ",(0,r.jsx)(n.a,{href:"https://parquet.apache.org/",children:"Apache Parquet"}),"\nformat, which provides efficient columnar storage suitable for analytics\nworkloads. Parquet files are significantly smaller than NDJSON and can be\nqueried directly using tools like Apache Spark, DuckDB, or pandas."]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"application/vnd.apache.parquet"})," or ",(0,r.jsx)(n.code,{children:"parquet"})," as the ",(0,r.jsx)(n.code,{children:"_outputFormat"})," value."]}),"\n",(0,r.jsxs)(n.p,{children:["The Parquet output follows the\n",(0,r.jsx)(n.a,{href:"/docs/libraries/io/schema",children:"Pathling Parquet specification"}),", which defines how\nFHIR resources are represented in the Parquet schema."]}),"\n",(0,r.jsx)(n.h2,{id:"asynchronous-processing",children:"Asynchronous processing"}),"\n",(0,r.jsxs)(n.p,{children:["The export operation uses the\n",(0,r.jsx)(n.a,{href:"https://hl7.org/fhir/R4/async.html",children:"FHIR Asynchronous Request Pattern"}),". Include\na ",(0,r.jsx)(n.code,{children:"Prefer: respond-async"})," header to initiate asynchronous processing."]}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as Client\n    participant P as Pathling\n    C->>P: GET /$export (Prefer: respond-async)\n    P--\x3e>C: 202 Accepted + Content-Location\n    loop Poll for status\n        C->>P: GET [status URL]\n        P--\x3e>C: 202 Accepted (in progress)\n    end\n    C->>P: GET [status URL]\n    P--\x3e>C: 200 OK + manifest\n    C->>P: GET $result?job=...&file=...\n    P--\x3e>C: Export file (NDJSON or Parquet)"}),"\n",(0,r.jsx)(n.h3,{id:"kick-off-request",children:"Kick-off request"}),"\n",(0,r.jsxs)(n.p,{children:["Parameters can be passed either as query parameters in a GET request or as a\nFHIR ",(0,r.jsx)(n.a,{href:"https://hl7.org/fhir/R4/parameters.html",children:"Parameters"})," resource in the body\nof a POST request."]}),"\n",(0,r.jsx)(n.p,{children:"Using GET with query parameters:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"GET [base]/$export?_type=Patient,Observation&_outputFormat=parquet HTTP/1.1\nAccept: application/fhir+json\nPrefer: respond-async\n"})}),"\n",(0,r.jsx)(n.p,{children:"Using POST with a Parameters resource:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST [base]/$export HTTP/1.1\nAccept: application/fhir+json\nContent-Type: application/fhir+json\nPrefer: respond-async\n\n{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "_type",\n            "valueString": "Patient,Observation"\n        },\n        {\n            "name": "_outputFormat",\n            "valueString": "parquet"\n        }\n    ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"kick-off-response",children:"Kick-off response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"HTTP/1.1 202 Accepted\nContent-Location: [base]/$exportstatus/[job-id]\n"})}),"\n",(0,r.jsx)(n.h3,{id:"polling",children:"Polling"}),"\n",(0,r.jsxs)(n.p,{children:["Poll the URL from ",(0,r.jsx)(n.code,{children:"Content-Location"})," until you receive a ",(0,r.jsx)(n.code,{children:"200 OK"})," response with\nthe export manifest."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"202 Accepted"})," \u2014 Export still in progress. Check ",(0,r.jsx)(n.code,{children:"X-Progress"})," header for status."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"200 OK"})," \u2014 Export complete. Response body contains the manifest."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"response-manifest",children:"Response manifest"}),"\n",(0,r.jsx)(n.p,{children:"When the export completes, the response contains a JSON manifest:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "transactionTime": "2025-01-15T10:30:00.000Z",\n    "request": "https://pathling.example.com/fhir/$export",\n    "requiresAccessToken": true,\n    "output": [\n        {\n            "type": "Patient",\n            "url": "https://pathling.example.com/fhir/$result?job=abc123&file=Patient.ndjson"\n        },\n        {\n            "type": "Observation",\n            "url": "https://pathling.example.com/fhir/$result?job=abc123&file=Observation.ndjson"\n        }\n    ],\n    "deleted": [],\n    "error": []\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"manifest-fields",children:"Manifest fields"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"transactionTime"})}),(0,r.jsx)(n.td,{children:"The time the export was initiated"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request"})}),(0,r.jsx)(n.td,{children:"The original kick-off request URL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"requiresAccessToken"})}),(0,r.jsx)(n.td,{children:"Whether authentication is required to download result files"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"output"})}),(0,r.jsx)(n.td,{children:"Array of exported files with resource type and download URL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"deleted"})}),(0,r.jsx)(n.td,{children:"Array of deleted resources (not currently supported)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"error"})}),(0,r.jsx)(n.td,{children:"Array of OperationOutcome files for any errors"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"retrieving-results",children:"Retrieving results"}),"\n",(0,r.jsxs)(n.p,{children:["Download exported files using the URLs in the manifest. Each URL points to the\n",(0,r.jsx)(n.code,{children:"$result"})," endpoint with ",(0,r.jsx)(n.code,{children:"job"})," and ",(0,r.jsx)(n.code,{children:"file"})," query parameters."]}),"\n",(0,r.jsx)(n.p,{children:"For NDJSON exports:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"GET [base]/$result?job=abc123&file=Patient.ndjson HTTP/1.1\nAccept: application/fhir+ndjson\n"})}),"\n",(0,r.jsx)(n.p,{children:"For Parquet exports:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"GET [base]/$result?job=abc123&file=Patient.parquet HTTP/1.1\nAccept: application/vnd.apache.parquet\n"})}),"\n",(0,r.jsx)(n.p,{children:"The file extension in the manifest URLs reflects the requested output format."}),"\n",(0,r.jsx)(n.h2,{id:"python-example",children:"Python example"}),"\n",(0,r.jsx)(n.p,{children:"The following Python script demonstrates the complete export workflow."}),"\n",(0,r.jsxs)(n.p,{children:["Run the script using ",(0,r.jsx)(n.a,{href:"https://docs.astral.sh/uv/",children:"uv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"uv run export_client.py\n"})}),"\n",(0,r.jsx)(n.h3,{id:"export-client",children:"Export client"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n# /// script\n# requires-python = ">=3.10"\n# dependencies = ["requests"]\n# ///\n"""Demonstrates the $export operation with async polling."""\n\nimport time\nimport requests\n\nBASE_URL = "https://pathling.example.com/fhir"\nOUTPUT_DIR = "./export"\n\n\ndef kick_off_export(resource_types=None):\n    """Initiate a bulk export."""\n    url = f"{BASE_URL}/$export"\n    params = {}\n    if resource_types:\n        params["_type"] = ",".join(resource_types)\n\n    headers = {\n        "Accept": "application/fhir+json",\n        "Prefer": "respond-async"\n    }\n\n    response = requests.get(url, params=params, headers=headers)\n\n    if response.status_code == 202:\n        status_url = response.headers.get("Content-Location")\n        print(f"Export started, polling: {status_url}")\n        return status_url\n    else:\n        response.raise_for_status()\n\n\ndef poll_status(status_url, timeout=3600):\n    """Poll the status endpoint until export completes."""\n    start = time.time()\n    interval = 2.0\n\n    while time.time() - start < timeout:\n        response = requests.get(\n            status_url,\n            headers={"Accept": "application/fhir+json"}\n        )\n\n        if response.status_code == 200:\n            print("Export complete")\n            return response.json()\n        elif response.status_code == 202:\n            progress = response.headers.get("X-Progress", "unknown")\n            print(f"In progress: {progress}")\n            time.sleep(interval)\n            interval = min(interval * 1.5, 30.0)\n        else:\n            response.raise_for_status()\n\n    raise TimeoutError(f"Export timed out after {timeout} seconds")\n\n\ndef download_files(manifest, output_dir):\n    """Download all files from the export manifest."""\n    import os\n    os.makedirs(output_dir, exist_ok=True)\n\n    for item in manifest.get("output", []):\n        resource_type = item["type"]\n        url = item["url"]\n        filename = f"{resource_type}.ndjson"\n        filepath = os.path.join(output_dir, filename)\n\n        print(f"Downloading {resource_type}...")\n        response = requests.get(\n            url,\n            headers={"Accept": "application/fhir+ndjson"}\n        )\n        response.raise_for_status()\n\n        with open(filepath, "wb") as f:\n            f.write(response.content)\n        print(f"  Saved to {filepath}")\n\n\ndef main():\n    """Execute the complete export workflow."""\n    # Export specific resource types (or None for all)\n    resource_types = ["Patient", "Observation", "Condition"]\n\n    print(f"Starting export for: {\', \'.join(resource_types)}")\n    status_url = kick_off_export(resource_types)\n\n    manifest = poll_status(status_url)\n    print(f"Manifest: {manifest}")\n\n    download_files(manifest, OUTPUT_DIR)\n    print("Export complete!")\n\n\nif __name__ == "__main__":\n    main()\n'})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(6540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);