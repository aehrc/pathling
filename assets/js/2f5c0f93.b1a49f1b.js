"use strict";(globalThis.webpackChunkpathling_site=globalThis.webpackChunkpathling_site||[]).push([[1245],{8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>d});var t=n(6540);const i={},r=t.createContext(i);function l(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:s},e.children)}},8803:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"server/operations/bulk-submit","title":"Bulk submit","description":"The bulk submit operation allows external systems to push FHIR data to the server using a staged submission workflow.","source":"@site/docs/server/operations/bulk-submit.md","sourceDirName":"server/operations","slug":"/server/operations/bulk-submit","permalink":"/docs/server/operations/bulk-submit","draft":false,"unlisted":false,"editUrl":"https://github.com/aehrc/pathling/tree/main/site/docs/server/operations/bulk-submit.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"description":"The bulk submit operation allows external systems to push FHIR data to the server using a staged submission workflow."},"sidebar":"server","previous":{"title":"Export","permalink":"/docs/server/operations/export"},"next":{"title":"Search","permalink":"/docs/server/operations/search"}}');var i=n(4848),r=n(8453);const l={sidebar_position:4,description:"The bulk submit operation allows external systems to push FHIR data to the server using a staged submission workflow."},d="Bulk submit",a={},o=[{value:"Operations",id:"operations",level:2},{value:"Submission workflow",id:"submission-workflow",level:2},{value:"$bulk-submit operation",id:"bulk-submit-operation",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Submission status values",id:"submission-status-values",level:3},{value:"Example request (submit manifest)",id:"example-request-submit-manifest",level:3},{value:"Example request (mark complete)",id:"example-request-mark-complete",level:3},{value:"Example request (abort submission)",id:"example-request-abort-submission",level:3},{value:"Example request (with explicit OAuth metadata URL)",id:"example-request-with-explicit-oauth-metadata-url",level:3},{value:"$bulk-submit-status operation",id:"bulk-submit-status-operation",level:2},{value:"Parameters",id:"parameters-1",level:3},{value:"Required headers",id:"required-headers",level:3},{value:"Responses",id:"responses",level:3},{value:"Response headers",id:"response-headers",level:3},{value:"Example request",id:"example-request",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Configuration options",id:"configuration-options",level:3},{value:"Submitter configuration",id:"submitter-configuration",level:3},{value:"Example configuration",id:"example-configuration",level:3},{value:"Python example",id:"python-example",level:2},{value:"Bulk submit client",id:"bulk-submit-client",level:3}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"bulk-submit",children:"Bulk submit"})}),"\n",(0,i.jsxs)(s.p,{children:["The bulk submit operation enables external systems (Data Providers) to push\nlarge\nFHIR datasets to Pathling using a staged submission workflow. This\nimplementation\nfollows\nthe ",(0,i.jsx)(s.a,{href:"https://hackmd.io/@argonaut/rJoqHZrPle",children:"Argonaut $bulk-submit specification"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"operations",children:"Operations"}),"\n",(0,i.jsx)(s.p,{children:"The bulk submit functionality consists of two operations:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Operation"}),(0,i.jsx)(s.th,{children:"Endpoint"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"$bulk-submit"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"POST [fhir base]/$bulk-submit"})}),(0,i.jsx)(s.td,{children:"Submit data manifests for processing"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"$bulk-submit-status"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"POST [fhir base]/$bulk-submit-status"})}),(0,i.jsx)(s.td,{children:"Check submission status and retrieve results"})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"submission-workflow",children:"Submission workflow"}),"\n",(0,i.jsx)(s.p,{children:"The bulk submit operation uses a staged workflow:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Submit manifests"})," \u2014 The Data Provider sends one or more requests with\n",(0,i.jsx)(s.code,{children:"submissionStatus: in-progress"})," and provides the ",(0,i.jsx)(s.code,{children:"manifestUrl"})," pointing to\nbulk data manifests. Pathling downloads the files in the background."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Mark complete"})," \u2014 Once all manifests have been submitted and downloads are\nfinished, the Data Provider sends a request with ",(0,i.jsx)(s.code,{children:"submissionStatus: complete"}),"\nto trigger the import into the data warehouse."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Poll status"})," \u2014 The Data Provider uses ",(0,i.jsx)(s.code,{children:"$bulk-submit-status"})," to check the\nprocessing status and retrieve results."]}),"\n"]}),"\n",(0,i.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant DP as Data Provider\n    participant PS as Pathling Server\n    DP->>PS: POST /$bulk-submit (in-progress + manifestUrl)\n    PS--\x3e>DP: 200 OK (downloading)\n    DP->>PS: POST /$bulk-submit (in-progress + manifestUrl)\n    PS--\x3e>DP: 200 OK (downloading)\n    DP->>PS: POST /$bulk-submit (complete)\n    PS--\x3e>DP: 200 OK (import started)\n    DP->>PS: POST /$bulk-submit-status\n    PS--\x3e>DP: 202 Accepted (X-Progress: 50%)\n    DP->>PS: POST /$bulk-submit-status\n    PS--\x3e>DP: 200 OK (manifest)"}),"\n",(0,i.jsx)(s.h2,{id:"bulk-submit-operation",children:"$bulk-submit operation"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"POST [fhir base]/$bulk-submit\n"})}),"\n",(0,i.jsx)(s.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Name"}),(0,i.jsx)(s.th,{children:"Cardinality"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"submitter"})}),(0,i.jsx)(s.td,{children:"1..1"}),(0,i.jsx)(s.td,{children:"Identifier"}),(0,i.jsx)(s.td,{children:"Identifier for the submitting system. Must match an entry in the server's allowed submitters list."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"submissionId"})}),(0,i.jsx)(s.td,{children:"1..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"Unique identifier for this submission, generated by the submitter."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"submissionStatus"})}),(0,i.jsx)(s.td,{children:"1..1"}),(0,i.jsx)(s.td,{children:"Coding"}),(0,i.jsxs)(s.td,{children:["Status of the submission: ",(0,i.jsx)(s.code,{children:"in-progress"}),", ",(0,i.jsx)(s.code,{children:"complete"}),", or ",(0,i.jsx)(s.code,{children:"aborted"}),"."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"manifestUrl"})}),(0,i.jsx)(s.td,{children:"0..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsxs)(s.td,{children:["URL of the bulk export manifest. Provided with ",(0,i.jsx)(s.code,{children:"in-progress"})," to submit manifests for downloading."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"fhirBaseUrl"})}),(0,i.jsx)(s.td,{children:"0..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsxs)(s.td,{children:["Base URL of the FHIR server that produced the manifest. Required when ",(0,i.jsx)(s.code,{children:"manifestUrl"})," is provided."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"oauthMetadataUrl"})}),(0,i.jsx)(s.td,{children:"0..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsxs)(s.td,{children:["Explicit URL to OAuth 2.0 metadata. If not provided, SMART discovery is used on ",(0,i.jsx)(s.code,{children:"fhirBaseUrl"}),"."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"replacesManifestUrl"})}),(0,i.jsx)(s.td,{children:"0..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsxs)(s.td,{children:["URL of a previous manifest to abort and replace with the new ",(0,i.jsx)(s.code,{children:"manifestUrl"}),"."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"fileRequestHeader"})}),(0,i.jsx)(s.td,{children:"0..*"}),(0,i.jsx)(s.td,{children:"-"}),(0,i.jsx)(s.td,{children:"Custom HTTP headers to include when downloading files from the manifest."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"metadata"})}),(0,i.jsx)(s.td,{children:"0..1"}),(0,i.jsx)(s.td,{children:"-"}),(0,i.jsxs)(s.td,{children:["Optional metadata including ",(0,i.jsx)(s.code,{children:"label"})," and ",(0,i.jsx)(s.code,{children:"description"})," for the submission."]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"submission-status-values",children:"Submission status values"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Status"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"in-progress"})}),(0,i.jsxs)(s.td,{children:["Submit manifests for downloading. Multiple ",(0,i.jsx)(s.code,{children:"in-progress"})," requests can be sent to add manifests."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"complete"})}),(0,i.jsx)(s.td,{children:"Signal that all manifests have been submitted. Triggers the import once all downloads are complete."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"aborted"})}),(0,i.jsx)(s.td,{children:"Cancel the submission. All in-progress downloads are stopped and the submission is marked as aborted."})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"example-request-submit-manifest",children:"Example request (submit manifest)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "submitter",\n            "valueIdentifier": {\n                "system": "https://example.com/systems",\n                "value": "hospital-ehr"\n            }\n        },\n        {\n            "name": "submissionId",\n            "valueString": "submission-2025-001"\n        },\n        {\n            "name": "submissionStatus",\n            "valueCoding": {\n                "code": "in-progress"\n            }\n        },\n        {\n            "name": "manifestUrl",\n            "valueString": "https://source-server.example.com/export/manifest.json"\n        },\n        {\n            "name": "fhirBaseUrl",\n            "valueString": "https://source-server.example.com/fhir"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"example-request-mark-complete",children:"Example request (mark complete)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "submitter",\n            "valueIdentifier": {\n                "system": "https://example.com/systems",\n                "value": "hospital-ehr"\n            }\n        },\n        {\n            "name": "submissionId",\n            "valueString": "submission-2025-001"\n        },\n        {\n            "name": "submissionStatus",\n            "valueCoding": {\n                "code": "complete"\n            }\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"example-request-abort-submission",children:"Example request (abort submission)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "submitter",\n            "valueIdentifier": {\n                "system": "https://example.com/systems",\n                "value": "hospital-ehr"\n            }\n        },\n        {\n            "name": "submissionId",\n            "valueString": "submission-2025-001"\n        },\n        {\n            "name": "submissionStatus",\n            "valueCoding": {\n                "code": "aborted"\n            }\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"example-request-with-explicit-oauth-metadata-url",children:"Example request (with explicit OAuth metadata URL)"}),"\n",(0,i.jsxs)(s.p,{children:["When the source server's OAuth metadata is not at the standard SMART discovery\nlocation, you can provide an explicit ",(0,i.jsx)(s.code,{children:"oauthMetadataUrl"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "submitter",\n            "valueIdentifier": {\n                "system": "https://example.com/systems",\n                "value": "hospital-ehr"\n            }\n        },\n        {\n            "name": "submissionId",\n            "valueString": "submission-2025-001"\n        },\n        {\n            "name": "submissionStatus",\n            "valueCoding": {\n                "code": "in-progress"\n            }\n        },\n        {\n            "name": "manifestUrl",\n            "valueString": "https://source-server.example.com/export/manifest.json"\n        },\n        {\n            "name": "fhirBaseUrl",\n            "valueString": "https://source-server.example.com/fhir"\n        },\n        {\n            "name": "oauthMetadataUrl",\n            "valueString": "https://auth.example.com/.well-known/oauth-authorization-server"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"bulk-submit-status-operation",children:"$bulk-submit-status operation"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"POST [fhir base]/$bulk-submit-status\n"})}),"\n",(0,i.jsx)(s.p,{children:"This operation retrieves the processing status and results for a submission."}),"\n",(0,i.jsx)(s.h3,{id:"parameters-1",children:"Parameters"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Name"}),(0,i.jsx)(s.th,{children:"Cardinality"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"submitter"})}),(0,i.jsx)(s.td,{children:"1..1"}),(0,i.jsx)(s.td,{children:"Identifier"}),(0,i.jsx)(s.td,{children:"The identifier of the submitting system."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"submissionId"})}),(0,i.jsx)(s.td,{children:"1..1"}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"The unique identifier of the submission to check."})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"required-headers",children:"Required headers"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Header"}),(0,i.jsx)(s.th,{children:"Value"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Accept"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"application/fhir+json"})}),(0,i.jsx)(s.td,{children:"Specifies the response format."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Prefer"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"respond-async"})}),(0,i.jsx)(s.td,{children:"Indicates asynchronous processing is expected."})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"responses",children:"Responses"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Status"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"202"}),(0,i.jsxs)(s.td,{children:["Processing in progress. Poll again later. ",(0,i.jsx)(s.code,{children:"Content-Location"})," and ",(0,i.jsx)(s.code,{children:"X-Progress"})," headers provided."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"200"}),(0,i.jsx)(s.td,{children:"Processing complete. Response body contains the status manifest."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"4XX"}),(0,i.jsx)(s.td,{children:"Error. Response body contains an OperationOutcome."})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"response-headers",children:"Response headers"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Header"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Content-Location"})}),(0,i.jsx)(s.td,{children:"URL to poll for status updates (returned with 202)."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"X-Progress"})}),(0,i.jsxs)(s.td,{children:["Progress percentage (e.g., ",(0,i.jsx)(s.code,{children:"50%"}),") indicating how much processing is done."]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"example-request",children:"Example request"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n    "resourceType": "Parameters",\n    "parameter": [\n        {\n            "name": "submitter",\n            "valueIdentifier": {\n                "system": "https://example.com/systems",\n                "value": "hospital-ehr"\n            }\n        },\n        {\n            "name": "submissionId",\n            "valueString": "submission-2025-001"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(s.p,{children:"The bulk submit operation requires server configuration to specify allowed\nsubmitters and source URLs. Submitters can optionally be configured with OAuth2\ncredentials for authenticated file downloads."}),"\n",(0,i.jsx)(s.h3,{id:"configuration-options",children:"Configuration options"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Property"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pathling.bulkSubmit.allowedSubmitters"})}),(0,i.jsx)(s.td,{children:"List"}),(0,i.jsx)(s.td,{children:"List of allowed submitter identifiers (system and value)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pathling.bulkSubmit.allowableSources"})}),(0,i.jsx)(s.td,{children:"List"}),(0,i.jsx)(s.td,{children:"URL prefixes allowed for manifest and file URLs"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"submitter-configuration",children:"Submitter configuration"}),"\n",(0,i.jsxs)(s.p,{children:["Each submitter in the ",(0,i.jsx)(s.code,{children:"allowedSubmitters"})," list supports the following properties:"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Property"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Required"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"system"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"Yes"}),(0,i.jsx)(s.td,{children:"The identifier system for the submitter."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"value"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"Yes"}),(0,i.jsx)(s.td,{children:"The identifier value for the submitter."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"clientId"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsx)(s.td,{children:"OAuth2 client ID for authenticated file downloads."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"clientSecret"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsx)(s.td,{children:"OAuth2 client secret for symmetric authentication."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"privateKeyJwk"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsx)(s.td,{children:"Private key in JWK format for asymmetric (JWT) authentication."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"scope"})}),(0,i.jsx)(s.td,{children:"string"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsxs)(s.td,{children:["OAuth2 scope to request (e.g., ",(0,i.jsx)(s.code,{children:"system/*.read"}),")."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"tokenExpiryTolerance"})}),(0,i.jsx)(s.td,{children:"number"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsx)(s.td,{children:"Seconds before token expiry to refresh (default: 120)."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useFormForBasicAuth"})}),(0,i.jsx)(s.td,{children:"boolean"}),(0,i.jsx)(s.td,{children:"No"}),(0,i.jsx)(s.td,{children:"Send credentials in form body instead of Authorization header (default: true)."})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"When OAuth credentials are configured, Pathling will:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Discover the token endpoint via SMART configuration (from ",(0,i.jsx)(s.code,{children:"fhirBaseUrl"}),") or\nuse the explicit ",(0,i.jsx)(s.code,{children:"oauthMetadataUrl"})," if provided in the request."]}),"\n",(0,i.jsx)(s.li,{children:"Acquire an access token using the configured credentials."}),"\n",(0,i.jsxs)(s.li,{children:["Include the access token in the ",(0,i.jsx)(s.code,{children:"Authorization"})," header when fetching manifests\nand files (if the manifest specifies ",(0,i.jsx)(s.code,{children:"requiresAccessToken: true"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"example-configuration",children:"Example configuration"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'pathling:\n    bulkSubmit:\n        allowedSubmitters:\n            # Submitter without OAuth - files must be publicly accessible.\n            -   system: "https://example.com/systems"\n                value: "public-submitter"\n            # Submitter with symmetric (client_secret) OAuth authentication.\n            -   system: "https://example.com/systems"\n                value: "hospital-ehr"\n                clientId: "pathling-client"\n                clientSecret: "secret-value"\n                scope: "system/*.read"\n            # Submitter with asymmetric (JWT) OAuth authentication.\n            -   system: "https://example.com/systems"\n                value: "clinic-system"\n                clientId: "pathling-jwt-client"\n                privateKeyJwk: \'{"kty":"EC","crv":"P-384","d":"...","x":"...","y":"..."}\'\n                scope: "system/*.read"\n        allowableSources:\n            - "https://source-server.example.com/"\n            - "s3://my-bucket/"\n'})}),"\n",(0,i.jsx)(s.h2,{id:"python-example",children:"Python example"}),"\n",(0,i.jsx)(s.p,{children:"The following Python script demonstrates the complete bulk submit workflow,\nincluding manifest submission, marking complete, and status polling."}),"\n",(0,i.jsxs)(s.p,{children:["Run the script using ",(0,i.jsx)(s.a,{href:"https://docs.astral.sh/uv/",children:"uv"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"uv run bulk_submit_client.py\n"})}),"\n",(0,i.jsx)(s.h3,{id:"bulk-submit-client",children:"Bulk submit client"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'#!/usr/bin/env python3\n# /// script\n# requires-python = ">=3.10"\n# dependencies = ["requests"]\n# ///\n"""Demonstrates the $bulk-submit workflow with status polling."""\n\nimport time\nimport uuid\nimport requests\n\n# Configuration\nPATHLING_URL = "https://pathling.example.com/fhir"\nSUBMITTER_SYSTEM = "https://example.com/systems"\nSUBMITTER_VALUE = "hospital-ehr"\nMANIFEST_URL = "https://source-server.example.com/export/manifest.json"\nFHIR_BASE_URL = "https://source-server.example.com/fhir"\n\n\ndef build_submitter():\n    """Build the submitter identifier."""\n    return {\n        "system": SUBMITTER_SYSTEM,\n        "value": SUBMITTER_VALUE\n    }\n\n\ndef submit_manifest(submission_id, manifest_url, fhir_base_url):\n    """Submit a manifest for downloading."""\n    params = {\n        "resourceType": "Parameters",\n        "parameter": [\n            {"name": "submitter", "valueIdentifier": build_submitter()},\n            {"name": "submissionId", "valueString": submission_id},\n            {\n                "name": "submissionStatus",\n                "valueCoding": {"code": "in-progress"}\n            },\n            {"name": "manifestUrl", "valueString": manifest_url},\n            {"name": "fhirBaseUrl", "valueString": fhir_base_url}\n        ]\n    }\n\n    response = requests.post(\n        f"{PATHLING_URL}/$bulk-submit",\n        json=params,\n        headers={"Content-Type": "application/fhir+json"}\n    )\n    response.raise_for_status()\n    print(f"Submitted manifest: {manifest_url}")\n\n\ndef mark_complete(submission_id):\n    """Mark the submission as complete to trigger the import."""\n    params = {\n        "resourceType": "Parameters",\n        "parameter": [\n            {"name": "submitter", "valueIdentifier": build_submitter()},\n            {"name": "submissionId", "valueString": submission_id},\n            {\n                "name": "submissionStatus",\n                "valueCoding": {"code": "complete"}\n            }\n        ]\n    }\n\n    response = requests.post(\n        f"{PATHLING_URL}/$bulk-submit",\n        json=params,\n        headers={"Content-Type": "application/fhir+json"}\n    )\n    response.raise_for_status()\n    print(f"Marked submission as complete: {submission_id}")\n\n\ndef poll_status(submission_id, timeout=3600):\n    """Poll the status endpoint until processing is complete."""\n    params = {\n        "resourceType": "Parameters",\n        "parameter": [\n            {"name": "submitter", "valueIdentifier": build_submitter()},\n            {"name": "submissionId", "valueString": submission_id}\n        ]\n    }\n\n    headers = {\n        "Content-Type": "application/fhir+json",\n        "Accept": "application/fhir+json",\n        "Prefer": "respond-async"\n    }\n\n    # Initial kick-off request\n    response = requests.post(\n        f"{PATHLING_URL}/$bulk-submit-status",\n        json=params,\n        headers=headers\n    )\n\n    if response.status_code == 200:\n        print("Processing already complete")\n        return response.json()\n    elif response.status_code != 202:\n        response.raise_for_status()\n\n    status_url = response.headers.get("Content-Location")\n    if not status_url:\n        raise ValueError("No Content-Location header in 202 response")\n\n    print(f"Polling status at: {status_url}")\n\n    start = time.time()\n    interval = 2.0\n\n    while time.time() - start < timeout:\n        response = requests.get(\n            status_url,\n            headers={"Accept": "application/fhir+json"}\n        )\n\n        if response.status_code == 200:\n            print("Processing complete")\n            return response.json()\n        elif response.status_code == 202:\n            progress = response.headers.get("X-Progress", "unknown")\n            print(f"In progress: {progress}")\n            time.sleep(interval)\n            interval = min(interval * 1.5, 30.0)\n        else:\n            response.raise_for_status()\n\n    raise TimeoutError(f"Status polling timed out after {timeout} seconds")\n\n\ndef main():\n    """Execute the complete bulk submit workflow."""\n    submission_id = f"submission-{uuid.uuid4()}"\n\n    print(f"Starting bulk submit workflow")\n    print(f"Submission ID: {submission_id}")\n    print()\n\n    # Step 1: Submit the manifest for downloading.\n    submit_manifest(submission_id, MANIFEST_URL, FHIR_BASE_URL)\n\n    # Step 2: Mark the submission as complete to trigger the import.\n    mark_complete(submission_id)\n\n    # Step 3: Poll for status.\n    result = poll_status(submission_id)\n    print()\n    print("Result:")\n    print(result)\n\n\nif __name__ == "__main__":\n    main()\n'})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);